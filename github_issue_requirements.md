# バナーコピー生成機能の実装

## 概要
ペルソナ・課題・ベネフィット・必須ワードの入力完了後、「クリエイティブを生成」ボタンを押すことで、AIが自動的にバナーコピーを生成し、ユーザーが編集可能な形で表示する機能を実装する。

## 背景
現在のアプリケーションでは、ブリーフ作成後にプレビュー画面に遷移するが、バナーコピーの詳細な生成・編集機能が不足している。ユーザーがより効果的な広告クリエイティブを作成できるよう、以下の機能を追加する必要がある。

## 要件

### 機能要件

#### 1. バナーコピー生成機能
- **トリガー**: ブリーフページで「クリエイティブを生成」ボタンを押下
- **入力データ**: 
  - ペルソナ（必須）
  - 課題（必須）
  - ベネフィット（必須）
  - 必須ワード（任意）
- **出力**: 以下の3つのコピー要素を生成
  - **メインテキスト**: 主要なキャッチコピー（20-30文字程度）
  - **サブテキスト**: 補足説明文（40-60文字程度）
  - **CTAボタン文言**: 行動喚起テキスト（5-15文字程度）

#### 2. コピー編集機能
- 生成されたバナーコピーをユーザーが編集可能
- リアルタイムプレビュー機能
- 文字数制限の表示とバリデーション
- 編集内容の自動保存

#### 3. バナーサイズ選択機能
- 以下のサイズから選択可能:
  - Google Ads リーダーボード (728×90)
  - Facebook/Instagram フィード (1080×1080)
  - Instagram ストーリー (1080×1920)
  - その他のカスタムサイズ
- サイズに応じたレイアウト最適化

#### 4. 背景スタイル選択機能
- **グラデーション背景**: 美しいカラーグラデーション（高速）
- **デザインパターン背景**: プロ品質のCSSパターン（ドット・ストライプ・グリッドなど）
- リアルタイムプレビュー機能

#### 5. バナー生成機能
- 選択されたサイズとスタイルでバナー画像を生成
- 複数パターンの同時生成（3種類×選択サイズ）
- 生成進捗の表示

### 技術要件

#### フロントエンド
- **フレームワーク**: Next.js 15.2.4 + React 19
- **UI コンポーネント**: Radix UI + Tailwind CSS
- **状態管理**: React hooks (useState, useEffect)
- **フォーム管理**: React Hook Form + Zod

#### バックエンド
- **データベース**: Supabase PostgreSQL
- **API**: Next.js API Routes
- **AI生成**: OpenAI GPT API または類似サービス
- **画像生成**: Canvas API または外部サービス

#### データベース設計
```sql
-- バナーコピーテーブルの追加
CREATE TABLE IF NOT EXISTS public.banner_copies (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  brief_id UUID REFERENCES public.briefs(id) ON DELETE CASCADE NOT NULL,
  main_text TEXT NOT NULL,
  sub_text TEXT,
  cta_text TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL
);

-- creativesテーブルの拡張
ALTER TABLE public.creatives ADD COLUMN IF NOT EXISTS banner_copy_id UUID REFERENCES public.banner_copies(id);
ALTER TABLE public.creatives ADD COLUMN IF NOT EXISTS banner_size TEXT DEFAULT '1200x628';
ALTER TABLE public.creatives ADD COLUMN IF NOT EXISTS background_style TEXT DEFAULT 'gradient';
```

### UI/UX要件

#### 1. バナーコピー編集画面
```
┌─────────────────────────────────────────┐
│ 📝 バナーコピー編集                        │
├─────────────────────────────────────────┤
│ メインテキスト                            │
│ ┌─────────────────────────────────────┐   │
│ │ 制作時間を90%短縮                    │   │
│ └─────────────────────────────────────┘   │
│ 文字数: 10/30                            │
│                                         │
│ サブテキスト                             │
│ ┌─────────────────────────────────────┐   │
│ │ AIが自動でプロ品質のバナーを生成      │   │
│ └─────────────────────────────────────┘   │
│ 文字数: 18/60                            │
│                                         │
│ CTAボタン                               │
│ ┌─────────────────────────────────────┐   │
│ │ 今すぐ試す                           │   │
│ └─────────────────────────────────────┘   │
│ 文字数: 5/15                            │
└─────────────────────────────────────────┘
```

#### 2. バナーサイズ選択
```
┌─────────────────────────────────────────┐
│ 📐 バナーサイズ選択                        │
├─────────────────────────────────────────┤
│ ○ Google Ads リーダーボード (728×90)      │
│ ● Facebook/Instagram フィード (1080×1080) │
│ ○ Instagram ストーリー (1080×1920)       │
│ ○ カスタムサイズ                         │
└─────────────────────────────────────────┘
```

#### 3. 背景スタイル選択
```
┌─────────────────────────────────────────┐
│ 🎨 背景スタイル選択                        │
├─────────────────────────────────────────┤
│ ○ グラデーション背景                      │
│   美しいカラーグラデーション（高速）        │
│                                         │
│ ● デザインパターン背景 🎨                 │
│   プロ品質のCSSパターン                   │
│   （ドット・ストライプ・グリッドなど）      │
└─────────────────────────────────────────┘
```

#### 4. リアルタイムプレビュー
```
┌─────────────────────────────────────────┐
│ 👁️ リアルタイムプレビュー                   │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐   │
│ │ [プレビュー画像]                     │   │
│ │ 制作時間を90%短縮                    │   │
│ │ AIが自動でプロ品質のバナーを生成      │   │
│ │ ┌─────────────┐                     │   │
│ │ │ 今すぐ試す    │                     │   │
│ │ └─────────────┘                     │   │
│ └─────────────────────────────────────┘   │
│                                         │
│ 🔄 プレビューは最初のパターン（ドット）です │
│ 実際の生成時は5種類のパターンを自動適用します │
└─────────────────────────────────────────┘
```

### 実装手順

#### Phase 1: バナーコピー生成・編集機能
1. **データベーススキーマの更新**
   - `banner_copies`テーブルの作成
   - `creatives`テーブルの拡張

2. **API エンドポイントの実装**
   - `POST /api/banner-copies/generate` - AIコピー生成
   - `PUT /api/banner-copies/{id}` - コピー更新
   - `GET /api/banner-copies/{briefId}` - コピー取得

3. **フロントエンド コンポーネント**
   - `BannerCopyEditor` コンポーネント
   - `CopyField` コンポーネント（文字数制限付き）
   - リアルタイムバリデーション

#### Phase 2: バナーサイズ・背景スタイル選択
1. **UI コンポーネント**
   - `BannerSizeSelector` コンポーネント
   - `BackgroundStyleSelector` コンポーネント
   - プレビュー機能

2. **状態管理**
   - サイズ・スタイル選択状態の管理
   - プレビュー更新ロジック

#### Phase 3: バナー生成機能
1. **画像生成API**
   - Canvas APIを使用したバナー生成
   - 複数パターンの同時生成
   - 進捗表示機能

2. **統合テスト**
   - エンドツーエンドテスト
   - パフォーマンステスト

### 受け入れ基準

#### 必須要件
- [ ] ペルソナ・課題・ベネフィット・必須ワード入力後、「クリエイティブを生成」ボタンでバナーコピーが生成される
- [ ] メインテキスト・サブテキスト・CTAボタン文言の3つが生成される
- [ ] 生成されたコピーがユーザーによって編集可能
- [ ] バナーサイズを選択できる（最低3種類）
- [ ] 背景スタイルを選択できる（グラデーション・デザインパターン）
- [ ] 選択完了後にバナー生成が開始される

#### 品質要件
- [ ] 文字数制限のバリデーション機能
- [ ] リアルタイムプレビュー機能
- [ ] レスポンシブデザイン対応
- [ ] エラーハンドリング
- [ ] ローディング状態の表示

#### パフォーマンス要件
- [ ] コピー生成: 5秒以内
- [ ] バナー生成: 10秒以内（1パターンあたり）
- [ ] プレビュー更新: 1秒以内

### 関連イシュー・参考資料
- 現在の実装: `app/brief/page.tsx`
- プレビュー画面: `app/preview/page.tsx`
- データベース設計: `supabase_setup.sql`
- UI コンポーネント: `components/ui/`

### 備考
- AIコピー生成にはOpenAI GPT-4またはClaude APIの使用を推奨
- 画像生成は初期段階ではCanvas APIで実装し、将来的に外部サービス（Midjourney API等）への移行を検討
- ユーザビリティテストを実施し、UI/UXの改善を継続的に行う 